# 外部数据包装器（FDW）扩展使用说明

PieCloudDB 支持使用外部数据包装器（FDW）扩展 postgres_fdw、mysql_fdw 和 oracle_fdw 来实现访问外部数据源数据的功能。

<note type="tip">
    <p>仅 PieDataCS 云原生平台的企业版支持外部数据包装器（FDW）扩展的功能。</p>   
</note>

在数仓操作界面，用户点击菜单栏的「**数据库**」后，在数据库列表中选择目标数据库并点击目标数据库名称就会进入数据库详情页面，之后切换到**Extension**页面，即可使用 FDW 扩展的相关功能。

FDW 扩展功能具有严格的使用权限限制，基于用户权限的管控层面，FDW 扩展的使用流程大致如下：
* 启用和配置 FDW 扩展
* 访问外表数据并执行相关操作
* 卸载 FDW 扩展

## 启用和配置 FDW 扩展功能

针对具有较高权限的用户，通常是管理员，请优先执行如下配置操作：

1. 启用 FDW 扩展

   在「**数据库**」页面的目标数据库下的 Extension 列表中，点击 **启用扩展**，并在下拉列表中选择所需要的扩展，点击 **完成** 即可添加扩展。

2. 创建外部服务器

   外部服务器定义了连接到外部数据源的方式。它是访问外部数据的入口，使得本地数据源能够通过 SQL 查询的方式访问远程数据。
   
   在「**数据库**」页面的目标数据库下的 Extension 列表中，点击目标扩展名称以进入扩展详情页面，在点击 **创建 Server** 即可进入外部服务器的配置页面。
  
3. 配置用户映射
   
   配置远程用户映射到本地用户，配置的远程用户和本地用户是一一对应的。

   在「**数据库**」页面的目标数据库下的 Extension 列表中，点击目标扩展名称以进入扩展详情页面。在关联 Server 列表中，选择目标外部服务器并点击隐藏菜单栏「…」下的 **用户映射** 选项即可进入用户映射的配置页面。

## 访问外表数据并执行相关操作

完成启用 FDW、创建外部服务器和配置用户映射的操作后，用户就可以执行外部表相关操作了，例如 `SELECT`、`UPDATE`、`DELETE`、`INSERT` 等。

<note type="attention">
    <p> 具有执行外部表关联查询等操作权限的用户是由所配置的用户映射中的“映射本地用户”指定的，而且该用户需要具有外部表的相关操作权限。</p>   
</note> 

本文以执行外部表的关联查询为例，介绍如何在数仓操作界面访问外部表的数据。

1. 在「**数据洞察**」页面打开一个 SQL 文件，连接目标数据库（即需要执行关联查询的数据库）和虚拟数仓。

2. 创建外部表。在「**数据洞察**」页面的 SQL 文件中，使用 `CREATE FOREIGN TABLE` 命令创建一个外部表，用于访问远程的表。

    <note type="tip">
       <p> 建议外部表的列与被引用的远程表相匹配。</p>   
    </note> 

3. 访问外部表的数据。在「**数据洞察**」页面的 SQL 文件中，使用 `SELECT` 命令访问远程表中的数据或者执行其他相关 DML 操作。  

## 卸载 FDW 扩展

具有相应权限的用户，通常是管理员，在「**数据库**」页面的目标数据库下的“Extension”列表中找到需要卸载的扩展。在该扩展旁边的隐藏菜单栏「…」下点击 **卸载**，即可进行扩展的卸载操作。需要注意的是，在卸载扩展之前，请先确保清除了所有相关依赖，否则可能会遇到错误，导致卸载失败。