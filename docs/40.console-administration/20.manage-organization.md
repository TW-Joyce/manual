# 管理组织

组织（Organization）在用户层面对应一个注册实体（例如个人用户、企业用户等），在架构层面对应计算空间和用户的管理单位。

## 创建组织

初始用户在 PieDataCS 云原生平台登录页面注册账号成功后，即会自动创建一个组织和一个组织下的计算空间。如果组织下的新增用户想要登录计算空间使用数据计算服务，需要申请加入对应的计算空间，或由管理员手动将其加入该组织下的计算空间中。

初始用户可以根据如下步骤创建组织：

1. 在登录页面，点击下方的 **没有账号? 立即注册**，即可跳转到注册账戶页面。

   <img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/pdb-admin-guide-ap/create-org.png" scope="external" />

2. 填写用户名、登录凭据信息（支持邮箱或手机号）、密码和确认密码。

   - 用户命名规则：用户名必须以英文字母开头，可以包含英文字母（区分大小写）、数字和下划线，最长为 63 个字符。
   - 密码规则：密码为 8 位以上，必须包含大小写字母、数字和特殊符号（!@#~$%^&*()+|_）。
   - 验证码：如果没有配置验证码服务，则无需输入验证码。

3. 填写好信息后点击 **完成注册**，如果显示注册成功的信息，页面会自动跳转进入计算空间并显示正在初始化。
4. 点击右上角用户信息栏的 **控制台** 选项，如果查看到组织信息和空间信息，这说明初始创建组织和空间成功。

   <img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/coc-pic/v1/console-option.png" scope="external" />

## 添加组织用户

在「**控制台**」界面，组织管理员（orgmanager）或该组织下具有相应管理权限的用户点击菜单栏中的 **用户管理** 即可进入对应的功能页面并查看该组织下的用户信息。

组织管理员（orgmanager）或该组织下具有相应管理权限的用户可以使用控制台的“邀请注册”功能，将用户加入到当前组织。具体操作步骤如下：

1. 在「**控制台**」界面展开右上角的菜单，点击 **邀请注册**。

   <img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/pdb-admin-guide-ap/manage-org-user.png" scope="external" />

2. 复制弹窗中的邀请链接，将链接地址发送给需要被添加到组织的用户。

   <img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/pdb-admin-guide-ap/manage-org-user-1.png" scope="external" />

3. 新用户点开链接后会进入到邀请注册页面。凭借收到的邀请码，输入相关信息和验证码完成注册。

   注册成功后，该用户会自动加入组织，同时组织管理员可以在控制台的「**用户管理**」菜单下的用户列表中查看到该用户的基本信息。

4. 新用户申请加入计算空间。

   <note type="attention">
      <p> 新增用户加入组织后，如果需要登录计算空间并使用数据计算服务，则要申请加入计算空间，或由组织管理员手动将其加入组织下的计算空间中。</p>   
   </note>

   组织管理员或该组织下具有相应用户管理权限的用户审核通过后，新用户即可登录控制台的「**计算空间**」页面，在计算空间列表中找到已申请加入的目标计算空间，在“操作”字段下点击 **进入空间** 即可。

## 配置组织第三方身份认证

PieDataCS 云原生平台支持配置 LDAP（轻量级目录访问协议）功能，该功能兼容 LDAP 和 LDAPS 协议，并通过身份验证和授权实现统一的访问控制和用户管理。

在「**控制台**」界面，组织管理员（orgmanager）或该组织下具有相应管理权限的用户点击菜单栏中的 **组织管理** 即可进入对应的功能页面并配置三方身份认证。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/coc-pic/v1/user-auth.png" scope="external" />

添加身份认证的具体操作步骤如下：

1. 在控制台的「**组织管理**」页面，点击 **添加身份认证**，即可进入 LDAP 配置页面。
2. 在 LDAP 配置页面，选择用户通过 LDAP 功能登录默认被分配的计算空间，如果不选则默认用户只加入组织。
3. 选择“首次登录是否需要管理员审核”，默认为不需要审核。
4. 填写 LDAP 或 LDAPS 地址、Bind DN（管理员 DN）、密码（管理员密码）、Base DN、搜索过滤器等信息。
5. 点击 **测试连接**，以验证 LDAP 配置是否可以连通。

   <img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/coc-pic/v1/add-ldap1.png" scope="external" />

6. 连通性验证成功后，点击 **添加**，即可将 LDAP 配置加入身份认证配置列表，且默认为停用状态。
7. 在用户身份认证配置列表中，用户点击目标身份认证配置所在行的 **启用**，即可启用 LDAP 服务。

   <img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/coc-pic/v1/enable-ldap.png" scope="external" />

启用后，目标身份认证配置所在行的登录入口即可显示登录信息。该组织下的用户可以直接复制登录入口提示的 URL 信息进行登录。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/coc-pic/v1/copy-ldap.png" scope="external" />

根据管理员配置的规则，用户需要输入用户名和密码。通常，用户名是邮箱地址，或者是用户名一般为邮箱地址或去掉邮箱域名后缀的前部分对应的用户名。

用户名具有如下固定的规则：

- 用户名必须以英文字母开头，可以包含英文字母（区分大小写）、数字和下划线，最长为 63 个字符。
- 组织下的用户名可能包含特殊字符等不符合规则的情况，此时需要用户修改用户名以在组织内使用，修改符合规则后方可登录成功。
- 首次登录成功后，当再次登录时，用户依然使用的是原来企业内部的用户名和密码。但在 PieDataCS 云原生平台内，用户的用户名会显示成适配数据库规则后的用户名。