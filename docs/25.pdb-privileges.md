# 权限管理体系概览

PieDataCS 云原生平台的权限管理体系以角色为基本管理单位，角色是用户权限概念的具体化体现。

## 权限分类

当用户访问 PieCloudDB 中的数据时，PieDataCS 云原生平台会从网络连接、数据加密、数据库对象权限三个维度对数据访问权限进行约束和限制。权限分配所涉及的相关概念包括：

* 数据库对象的访问权限

  数据库对象是数据库中用于管理数据的实体，包括表、视图、Schema 和序列（Sequence）等。

* 角色 

  角色是一组权限的集合，具备继承和授予的功能，可以将权限授予给其他用户或角色。

* 用户 
  
  用户通常指拥有登录凭据和访问权限的个人或应用程序。
  
* 系统权限 

  系统权限指的是云原生平台的功能使用权限。

需要注意的是，PieDataCS 云原生平台的权限系统会因版本不同而略有差异，并且控制台界面和计算空间操作界面各自拥有一套独立的权限体系。

控制台界面的权限仅涉及系统权限，详细信息请参见 [管理组织角色](40.console-administration/50.manage-organization-roles.md)。

而计算空间操作界面的权限分为两个部分：PieDataCS 系统权限和 PieCloudDB 数据库对象权限。通过在计算空间下建立的角色，既可以控制数据库对象权限，也可以控制计算空间的系统权限。数据库对象权限源自数据库中的角色权限，所有者可以将数据库对象权限下放给特定角色。对于在计算空间中创建的角色，其在数据库中的权限与计算空间下的数据库对象权限保持一致。有关系统权限的详细信息，请参见 [管理系统权限](50.computational-spaces-guide/90.manage-space-role.md)。

计算空间操作界面中的功能因其特性不同，对权限的要求也各不相同，通常可以分为以下三类：

* 功能仅涉及计算空间的系统权限。
* 功能仅涉及数据库对象权限。
* 功能同时涉及系统权限和数据库对象权限。

在计算空间操作界面，有关数据库对象权限的详细信息，请参见 [管理数据库对象权限](50.computational-spaces-guide/40.use-database-list.md)。

## 角色的继承与赋予

继承是指将权限以角色的形式传递给另一个角色的过程。在层级结构中，继承的角色应高于被继承的角色，且继承角色的权限与被继承角色的权限保持一致。这意味着，即使收回了继承角色所继承的权限，该权限状态也会与被继承角色保持一致，而不会被实际收回。一个角色可以继承另一个角色的权限，且继承的权限即使被改动，其状态也会与被继承角色相应的权限保持一致。这种继承关系在各角色间形成了一个层次结构。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/pdb-admin-guide-ap/role-inheritance.png" scope="external" />

赋予是指将权限以角色的形式下放给用户的行为。拥有角色管理权限的用户或角色，可以将特定角色及其关联的权限授予给其他用户。

## 角色的赋权流程

PieDataCS 云原生平台支持创建自定义角色并设置权限，一般流程如下图所示。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/pdb-admin-guide-ap/role-empower.png" scope="external" />

假设数仓管理员已将用户管理员及数据库管理员赋予了相应的用户，用户管理员可为新用户组建立自定义角色，并对该角色的系统权限进行设置。设置完毕后，用户管理员再将该角色赋予用户组。

在自定义角色设立后，数据库管理员创建该角色所对应的数据库对象，并将相应的数据库对象权限赋予该角色，通过数据库对象权限来约束相应数据的读写权限。角色权限管控下的用户组，可通过其对应的角色，在适当的权限条件下探索数据。

在数仓中的用户（除数仓管理员外）未被赋予任何角色的情况下，数仓管理员需要先设置好用户管理员及数据库管理员，再由这两个角色对新角色权限进行设置。

本文将通过具体示例详细介绍 PieDataCS 云原生平台的赋权流程。

**示例：假设某公司需要对某几类线上产品的销售额进行存储和分析。该公司的数据管理团队决定由 David、Betty 和 Charlie 三位负责管理这部分数据及其附属的权限，并支持业务部门的 Adam 进行销售数据分析工作。**

针对本示例的赋权步骤如下：

1. 设置用户管理员及数据库管理员：David作为数仓管理员，将用户管理员角色赋予 Betty。Betty 被赋予用户管理员权限后，开始承担用户权限的管理职责，并将数据库管理员角色赋予给 Charlie。
2. 用户管理员创建自定义角色并赋予系统权限：各管理员角色就位后，Betty 为 Adam 创建其对应的角色，并设置系统权限，然后将该角色赋予给 Adam。
3. 数据库管理员创建虚拟数仓并赋予数据库对象权限：根据 Adam 的需求，Charlie 为其角色创建对应的数据库对象，并将这些数据库对象的权限分配给 Adam 的角色。

通过类似的步骤，可以根据每组用户的特性（例如数据类型、功能需求等）来创建对应的角色。

在上述示例中，用户管理员 Betty 和数据库管理员 Charlie 可以使用同样的步骤为来自其他业务部门的 Ella 和 Fiona 建立相应的角色，并根据她们的需求赋予系统和数据库对象权限。

下图展示了 Adam、Ella 和 Fiona 在数据库中的读取权限。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/pdb-admin-guide-ap/role-enpower-1.png" scope="external" />

Adam、Ella 和 Fiona 都来自业务部门，他们分别属于不同的团队，并且对数据权限和开发需求各有不同。PieCloudDB 的权限系统允许这些用户通过分配的角色，根据各自的角色权限安全地进行数据的读取和写入操作。这使得他们能够按照自己的需求进行数据清理、业务分析和开发工作。