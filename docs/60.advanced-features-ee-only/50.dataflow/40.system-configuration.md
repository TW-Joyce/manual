# 配置调度系统

系统配置涵盖 S3 配置和调度器设置。在数据的离线同步过程中，调度器（dataflow-worker）负责管理数据的导出、导入和校验任务。数据源中导出的数据将被保存到 S3，作为备份存储。

<note type="tip">
   <p> S3 配置和调度器配置仅适用于批处理数据的场景，该配置信息会应用于创建离线同步任务。</p>   
</note>

数据集成的「**总览**」页面提供了一个进入系统配置的入口。用户在该页面点击 **系统配置** 即可进入系统配置页面。

## 添加 S3 配置

S3 对象存储作为数据流转的中间站，负责存储从不同的数据源抽取的数据，然后加载数据到目标数据库（例如 PieCloudDB）。

添加 S3 配置的步骤如下：
1. 在系统配置的「**S3 配置**」页面，点击 **添加 S3 配置** 即可进入创建 S3 配置的页面。
2. 在创建 S3 配置页面，输入如下 S3 配置信息：
   * 名称：S3 配置的自定义名称。
   * Endpoint：与 S3 服务通信的终端 URL 地址。
   * Region：S3 服务所在的区域，每个区域都有一个唯一的标识符。
   * Bucket Name：存放备份文件的 S3 Bucket 名称，需要提前创建。
   * S3 Access Key：访问密钥。
   * S3 Secret Key：私有访问密钥。
3. 点击 **完成**。操作成功后，新添加的 S3 配置会自动同步到列表中。

系统配置的「**S3 配置**」页面以列表形式展示当前已有的 S3 配置信息。该页面还支持添加 S3 配置，以及对 S3 配置的修改和删除操作。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/dataflow/v2/add-s3-configuration1.png" scope="external" />

针对于添加后的 S3 配置，用户可以执行如下操作：

* 修改/删除：指定某条 S3 配置，用户点击隐藏的列表并选择对应选项来“修改”或者“删除”该 S3 配置。
* 设为默认配置：如果系统配置了多个 S3 对象存储，第一个 S3 配置会自动成为默认配置。用户可以滑动开关指定默认的 S3 配置。

  该设置会影响离线同步任务的运行配置中所涉及的 S3_config_id 字段值，如果在创建离线同步任务时未手动配置 S3_config_id，系统就会使用默认的 S3 配置。有关离线同步任务的详细信息，请参见 [创建离线同步任务](90.create-offline-sync-task.md)。

## 添加调度器配置

在数据集成过程中，调度器负责发起数据的导出、导入和校验任务。调度系统会根据执行周期、调度环境、运行配置等因素，对数据的离线同步任务进行协调和管理，这称为作业调度。

添加调度器配置的步骤如下：
1. 在系统配置的「**调度器配置**」页面，点击 **添加调度器** 即可进入创建调度器的页面。
2. 在创建调度器配置页面，输入如下调度器信息：
   * 名称：调度器的自定义名称。
   * 主机：Piescheduler 所在宿主机的 IP 地址。
   * 端口：Piescheduler 的 nodePort 暴露出的端口号。
   * Workflow Names：工作流的名称。
   * Task Queues：任务队列的名称。

   <note type="tip">
      <p> 基于客户真实环境中所部署的 LoadBalancer，主机和端口号可以为 LoadBalancer 的 IP 和其所暴露的端口号。</p>   
   </note>

3. 点击 **完成**。操作成功后，新添加的调度器配置会自动同步到列表中。

系统配置的「**调度器配置**」页面以列表形式展示当前已有的调度器配置信息。在目标调度器配置所在行，启用默认配置开关，可以将目标调度器设置为默认调度器。

<img src="https://pdb-doc.oss-cn-beijing.aliyuncs.com/dataflow/v2/add-piescheduler-config2.png" scope="external" />

在列表中，用户点击目标调度器配置所在行的隐藏的下拉列表并选择对应选项来 **修改** 或者 **删除** 该调度器配置。